C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\m
                    -ain.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2          ***STC89C52
   3          * 2-P1.1-LEDGND2
   4          * 3-P1.2-LEDGND3
   5          * 4-P1.3-LEDGND4
   6          * 5-P1.4-LEDGND1
   7          * 6-P1.5-1602RS
   8          * 7-P1.6-1602RW
   9          * 8-P1.7-1602EN
  10          * 9-RST-KEY0
  11          * 12-P3.2-KEY1
  12          * 13-P3.3-KEY2
  13          * 18-XTAL1
  14          * 19-XTAL2
  15          * 20-GND
  16          * 22-P2.1-595OE4_13
  17          * 23-P2.2-595OE3_13
  18          * 24-P2.3-5950E2_13
  19          * 25-P2.4-595DS_14
  20          * 26-P2.5-595OE1_13,HIGH-OFF
  21          * 27-P2.6-595RCK_12,UP-LINEMOVE
  22          * 28-P2.7-595SCK_11,UP-BITMOVE
  23          * 29-PSEN-595SCLR_10,ALWAYSHIGH
  24          * 31-VCC
  25          * 32-P0.7-1602DATA7
  26          * 33-P0.6-1602DATA6
  27          * 34-P0.5-1602DATA5
  28          * 35-P0.4-1602DATA4
  29          * 36-P0.3-1602DATA3
  30          * 37-P0.2-1602DATA2
  31          * 38-P0.1-1602DATA1
  32          * 39-P0.0-1602DATA0
  33          *
  34          ***LCD1602
  35          * 1-GND
  36          * 2-VCC
  37          * 3-VL
  38          * 4-RS
  39          * 5-RW
  40          * 6-EN
  41          * 7-DATA0
  42          * 8-DATA1
  43          * 9-DATA2
  44          * 10-DATA3
  45          * 11-DATA4
  46          * 12-DATA5
  47          * 13-DATA6
  48          * 14-DATA7
  49          * 15-VCC
  50          * 16-GND
  51          *
  52          ***74HC595
  53          * 1-OUT0-LEFTRED
  54          * 2-OUT1-RIGHTBLUE
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 2   

  55          * 3-OUT2-RIGHTRED
  56          * 4-OUT3
  57          * 5-OUT4
  58          * 6-OUT5
  59          * 7-OUT6
  60          * 8-GND
  61          * 9-STRINGOUT
  62          * 10-MR-ALWAYSLOW
  63          * 11-SCK
  64          * 12-LCK
  65          * 13-OE
  66          * 14-DATAIN
  67          * 15-OUT7
  68          * 16-VCC
  69          */
  70          
  71          #include <reg52.h>
  72          #include <intrins.h>
  73          //#define TEST
  74          #define INT int
  75          #define UNSIGNED unsigned
  76          #define CHAR char
  77          #define SBIT sbit
  78          #define VOID void
  79          #define LONG long
  80          #define IF if
  81          #define FOR for
  82          #define WHILE while
  83          #define INTERRUPT interrupt
  84          #define NOP() _nop_()
  85          #define mian main
  86          typedef unsigned int uint;
  87          typedef unsigned char uchar;
  88          typedef unsigned long ulong;
  89          
  90          sbit KEY1=P3^2;
  91          sbit KEY2=P3^3;
  92          sbit RCK=P2^6;
  93          sbit SCK=P2^7;
  94          sbit OE1=P2^5;
  95          #ifdef TEST
              sbit OE2=P2^0;//TEMP FOR TEST!!
              #else
  98          sbit OE2=P2^3;
  99          #endif
 100          sbit OE3=P2^2;
 101          sbit OE4=P2^1;
 102          sbit MOSIO=P2^4;
 103          sbit tempIO=P1^0;
 104          sbit rs=P1^5;
 105          sbit rw=P1^6;
 106          sbit lcden=P1^7;
 107          sbit LEDGND1=P1^4;
 108          sbit LEDGND2=P1^1;
 109          sbit LEDGND3=P1^2;
 110          sbit LEDGND4=P1^3;
 111          sbit LED=P2^0;
 112          
 113          uchar table1[]="Hello world!";
 114          uchar table2[]=" LEDCUBE ";
 115          unsigned int led=0xff;
 116          unsigned long tt=0;
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 3   

 117          unsigned long keyNum=0;
 118          char keyNumString[20];
 119          uchar a,g;
 120          uchar modifyFlag=0;
 121          uint temp=0;
 122          unsigned char i;
 123          uchar LEDBREATHE;
 124          
 125          void HC595SendData(unsigned int SendVal);
 126          void tim0Init();
 127          //void fakeDelay(unsigned int i);
 128          void pwm(char);
 129          void keyInit();
 130          char* itoa(unsigned long num,char* str,int radix);
 131          void lcdInit();
 132          void write_date(unsigned char date);
 133          void write_com(uchar com);
 134          void ledInit();
 135          void delayT(long);
 136          void delay(uint);
 137          void light(char l,ulong d1,ulong d2,ulong d3,ulong d4);
 138          void breathe(uint);
 139          void oneByOne(uint);
 140          void layerSwitch(uchar l);
 141          
 142          void main( )
 143          {
 144   1              LED=1;
 145   1              //tim0Init();
 146   1              keyInit();
 147   1              //lcdInit();
 148   1              ledInit();
 149   1              LED=0;
 150   1          while(1)
 151   1          {
 152   2                      oneByOne(500);
 153   2          }
 154   1              
 155   1      }
 156          
 157          //void light(uchar l,ulong d1,ulong d2,ulong d3,ulong d4)
 158          //{
 159          //      send32(d1);
 160          //      layerSwitch(l);
 161          //      send32(d2);
 162          //      layerSwitch(l);
 163          //      send32(d3);
 164          //      layerSwitch(l);
 165          //      send32(d4);
 166          //      layerSwitch(l);
 167          //}
 168          
 169          void delay(uint t)
 170          {
 171   1              uint X,Y;
 172   1              LED=1;
 173   1              tempIO=1;
 174   1              for(Y=0;Y<t;Y++)
 175   1                      for(X=50;X>0;X--);
 176   1              tempIO=0;
 177   1              LED=0;
 178   1                      for(Y=0;Y<t;Y++)
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 4   

 179   1                      for(X=50;X>0;X--);
 180   1      }
 181          
 182          //void fakeDelay(uint t)
 183          //{
 184          //      uchar x;
 185          //      for(t;t>=0;t--)
 186          //              for(x=110;x>=0;x--)g++;
 187          //}
 188          
 189          void oneByOne(uint t)
 190          {
 191   1              uint i,j,k;
 192   1              for(k=1;k<16;k*=2)
 193   1              {
 194   2                      layerSwitch(k);
 195   2                      for(i=1;i<8;i++)
 196   2                      {
 197   3                              HC595SendData(1<<i);
 198   3                              delay(t);
 199   3                              for(j=1;j<4;j++){HC595SendData(0);delay(t);}
 200   3                      }
 201   2                      HC595SendData(1);
 202   2                      delay(t);
 203   2                      for(j=1;j<4;j++){HC595SendData(0);delay(t);}
 204   2              }
 205   1      }
 206          
 207          void layerSwitch(uchar l)
 208          {
 209   1              LEDGND1=!(l&1);
 210   1              LEDGND2=!(l&2);
 211   1              LEDGND3=!(l&4);
 212   1              LEDGND4=!(l&8);
 213   1      }
 214          
 215          void breathe(uint num)
 216          {
 217   1              HC595SendData(num);
 218   1              HC595SendData(num);
 219   1              HC595SendData(num);
 220   1              HC595SendData(num);
 221   1                      
 222   1              LEDBREATHE=20;
 223   1              for(temp=0;temp<LEDBREATHE;temp++)
 224   1              {
 225   2                      OE1=OE2=OE3=OE4=1;
 226   2                      delay(temp);
 227   2                      OE1=OE2=OE3=OE4=0;
 228   2                      delay(LEDBREATHE-temp);
 229   2              }
 230   1                      for(temp=LEDBREATHE;temp>0;temp--)
 231   1              {
 232   2                      OE1=OE2=OE3=OE4=1;
 233   2                      delay(temp);
 234   2                      OE1=OE2=OE3=OE4=0;
 235   2                      delay(LEDBREATHE-temp);
 236   2              }
 237   1      }
 238          
 239          void ledInit()
 240          {
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 5   

 241   1              //uint a=0;
 242   1              OE1=OE2=OE3=OE4=0;      
 243   1              LEDGND1=LEDGND2=LEDGND3=LEDGND4=0;
 244   1              //for(a=1;a<=16;++a)HC595SendData(0xff);
 245   1      }
 246          
 247          void HC595SendData(unsigned int SendVal)
 248          {
 249   1              
 250   1          unsigned char i;
 251   1              LED=1;
 252   1          for(i=0;i<8;i++)
 253   1          {
 254   2              if((SendVal<<i)&0x80)MOSIO=1;
 255   2              else MOSIO=0;
 256   2                                      //MOSIO=1;  
 257   2                              SCK=0;
 258   2              NOP();NOP();
 259   2              SCK=1;
 260   2          }
 261   1              RCK=0;
 262   1              NOP();NOP();
 263   1              RCK=1;
 264   1              LED=0;
 265   1      }
 266          
 267          void keyInit()
 268          {
 269   1              EA=1;
 270   1              EX0=1;
 271   1              IT0=1;
 272   1              EX1=1;
 273   1              IT1=1;
 274   1      }
 275          
 276          
 277          
 278          void key1Scan() interrupt 0
 279          {
 280   1              char i;
 281   1                      if(KEY1==0)
 282   1                      {
 283   2                              delay(5);
 284   2                              if(KEY1==0)
 285   2                              {
 286   3                                      //HC595SendData(0xff);
 287   3                                      if(keyNum&1)
 288   3                                      {
 289   4                                              keyNum++;
 290   4                                              for(i=1;i<5;i++)
 291   4                                              {
 292   5                                                      breathe(0xaa);
 293   5                                                      delay(500);
 294   5                                              }
 295   4                                                      
 296   4                                      }
 297   3                                      else
 298   3                                      {
 299   4                                              keyNum++;
 300   4                                              for(i=1;i<5;i++)
 301   4                                              {
 302   5                                                      delay(500);
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 6   

 303   5                                                      breathe(0x55);
 304   5                                              }
 305   4                                              
 306   4                                      }                                       
 307   3                              }
 308   2                              while(!KEY1||!KEY2);
 309   2                      }
 310   1              
 311   1      
 312   1      }
 313          
 314          void key2Scan() interrupt 2
 315          {
 316   1              //modifyFlag=1;
 317   1              if(KEY2==0)
 318   1                      {
 319   2                              delay(5);
 320   2                              if(KEY2==0)
 321   2                              {
 322   3                                      unsigned char i;
 323   3                                      for(i=0;i<8;i++)
 324   3                                      {
 325   4                                              MOSIO=0;  
 326   4                                              SCK=0;
 327   4                                              NOP();NOP();
 328   4                                              SCK=1;
 329   4                                      }
 330   3                                      RCK=0;
 331   3                                      NOP();NOP();
 332   3                                      RCK=1;
 333   3                                      keyNum++;
 334   3                                      keyNum++;
 335   3                              }
 336   2                              while(!KEY1||!KEY2);
 337   2                      }
 338   1      }
 339          
 340          //void tim0Init()
 341          //{
 342          //      TMOD=0x00;               //Ä£Ê½ÉèÖÃ£¬00000001£¬¿É¼û²ÉÓÃµÄÊÇ¶¨Ê±Æ÷0£¬¹¤×÷ÓëÄ£Ê½1£¨M1=0£¬M0=1£©¡£
 343          //      TH0=(8192-921)/32;               //¶¨Ê±Æ÷ÉèÖÃ£¬Ã¿¸ô1ms·¢ÆðÒ»´ÎÖÐ¶Ï¡£
 344          //      TL0=(8192-921)%32;
 345          //      TR0=1;                   //´ò¿ª¶¨Ê±Æ÷
 346          //      ET0=1;                   //¿ª¶¨Ê±Æ÷0ÖÐ¶Ï
 347          //      EA=1;                    //¿ª×ÜÖÐ¶Ï
 348          //}
 349          
 350          //void time0() interrupt 1
 351          //{     TH0=(8192-921)/32;               //¶¨Ê±Æ÷ÉèÖÃ£¬Ã¿¸ô5ms·¢ÆðÒ»´ÎÖÐ¶Ï¡£
 352          //      TL0=(8192-921)%32;
 353          //      tt++;
 354          //}
 355          
 356          
 357          
 358          //void fakeDelay(unsigned int t)
 359          //{ 
 360          //      unsigned int i,j;
 361          //      for(i=t;i>0;i--)
 362          //              for(j=110;j>0;j--)NOP();
 363          //}
 364          /*
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 7   

 365          
 366          void pwm(char a)
 367          {
 368                  //char i,temp=0;
 369          //      for(i=1;i<=a;i++)
 370          //      {
 371          //              HC595SendData(Led);
 372          //              HC595SendData(Led);
 373          //      }
 374          //      for(i=a;i<=100;i++)
 375          //      {OE=1;temp++;}
 376          //      OE=0;
 377                  HC595SendData(Led);
 378                  HC595SendData(Led);
 379                  delay(a);
 380                  OE=1;
 381                  delay(100-a);
 382                  OE=0;
 383          }
 384          */
 385          
 386          
 387          
 388          //void delay(uint x)
 389          //{
 390          //      uint a,b;
 391          //      for(a=x;a>0;a--)
 392          //              for(b=10;b>0;b--); 
 393          //}
 394          
 395          //void write_com(uchar com)
 396          //{
 397          //      P0=com;
 398          //      rs=0;
 399          //      lcden=0;
 400          //      delay(10);
 401          //      lcden=1;
 402          //      delay(10);
 403          //      lcden=0;
 404          //      
 405          //}
 406          
 407          //void write_date(uchar date)
 408          //{
 409          //      P0=date;
 410          //      rs=1;
 411          //      lcden=0;
 412          //      delay(10);
 413          //      lcden=1;
 414          //      delay(10);
 415          //      lcden=0;
 416          //      
 417          //}
 418          
 419          //void lcdInit()
 420          //{
 421          //    rw=0;
 422          //      write_com(0x38);   //ÏÔÊ¾Ä£Ê½ÉèÖÃ£º16¡Á2ÏÔÊ¾£¬5¡Á7µãÕó£¬8Î»Êý¾Ý½Ó¿Ú
 423          //      delay(20);
 424          //      write_com(0x0f);   //ÏÔÊ¾Ä£Ê½ÉèÖÃ
 425          //      delay(20);
 426          //      write_com(0x06);   //ÏÔÊ¾Ä£Ê½ÉèÖÃ£º¹â±êÓÒÒÆ£¬×Ö·û²»ÒÆ
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 8   

 427          //      delay(20);
 428          //      write_com(0x01);   //ÇåÆÁÄ»Ö¸Áî£¬½«ÒÔÇ°µÄÏÔÊ¾ÄÚÈÝÇå³ý
 429          //      delay(20);      
 430          //      
 431          //              write_com(0x80);         //½«µÚÒ»¸ö×Ö·ûÐ´ÔÚÏòÓÒÆ«ÒÆ17¸ö×Ö·û´¦£¬ÎªºóÃæµÄÓÉÓÒÏò×ó»®Èë×ö×¼±¸¡£
 432          //      delay(20);
 433          
 434          //      for(a=0;a<14;a++)
 435          //      {
 436          //              write_date(table1[a]);
 437          //              delay(20);              
 438          //      }
 439          //      
 440          //      write_com(0xc0);
 441          //      delay(50);
 442          //      for(a=0;a<14;a++)
 443          //      {
 444          //              write_date(table2[a]);
 445          //              delay(40);              
 446          //      }
 447          //}
 448          
 449          //void delayT(long t)
 450          //{
 451          //      unsigned long temp=tt;
 452          //      while(1)
 453          //      {
 454          //              if(tt>=(temp+t))break;
 455          //      }
 456          //      tt=0;
 457          //}
 458          
 459          
 460          //char* itoa(unsigned long num,char* str,int radix)
 461          //{
 462          //      char temp;//ÁÙÊ±±äÁ¿£¬½»»»Á½¸öÖµÊ±ÓÃµ½
 463          //      char index[]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";//Ë÷Òý±í
 464          //      unsigned unum;//´æ·ÅÒª×ª»»µÄÕûÊýµÄ¾ø¶ÔÖµ,×ª»»µÄÕûÊý¿ÉÄÜÊÇ¸ºÊý
 465          //      int i=0,j,k;//iÓÃÀ´Ö¸Ê¾ÉèÖÃ×Ö·û´®ÏàÓ¦Î»£¬×ª»»Ö®ºóiÆäÊµ¾ÍÊÇ×Ö·û´®µÄ³¤¶È£»×ª»»ºóË³ÐòÊÇÄæÐòµÄ£¬ÓÐÕý¸ºµÄÇé¿
             -ö£¬kÓÃÀ´Ö¸Ê¾µ÷ÕûË³ÐòµÄ¿ªÊ¼Î»ÖÃ;jÓÃÀ´Ö¸Ê¾µ÷ÕûË³ÐòÊ±µÄ½»»»¡£
 466          // 
 467          //      //»ñÈ¡Òª×ª»»µÄÕûÊýµÄ¾ø¶ÔÖµ
 468          //      if(radix==10&&num<0)//Òª×ª»»³ÉÊ®½øÖÆÊý²¢ÇÒÊÇ¸ºÊý
 469          //      {
 470          //              unum=(unsigned)-num;//½«numµÄ¾ø¶ÔÖµ¸³¸øunum
 471          //              str[i++]='-';//ÔÚ×Ö·û´®×îÇ°ÃæÉèÖÃÎª'-'ºÅ£¬²¢ÇÒË÷Òý¼Ó1
 472          //      }
 473          //      else unum=(unsigned)num;//ÈôÊÇnumÎªÕý£¬Ö±½Ó¸³Öµ¸øunum
 474          // 
 475          //      //×ª»»²¿·Ö£¬×¢Òâ×ª»»ºóÊÇÄæÐòµÄ
 476          //      do
 477          //      {
 478          //              str[i++]=index[unum%(unsigned)radix];//È¡unumµÄ×îºóÒ»Î»£¬²¢ÉèÖÃÎªstr¶ÔÓ¦Î»£¬Ö¸Ê¾Ë÷Òý¼Ó1
 479          //              unum/=radix;//unumÈ¥µô×îºóÒ»Î»
 480          // 
 481          //      }while(unum);//Ö±ÖÁunumÎª0ÍË³öÑ­»·
 482          // 
 483          //      str[i]='\0';//ÔÚ×Ö·û´®×îºóÌí¼Ó'\0'×Ö·û£¬cÓïÑÔ×Ö·û´®ÒÔ'\0'½áÊø¡£
 484          // 
 485          //      //½«Ë³Ðòµ÷Õû¹ýÀ´
 486          //      if(str[0]=='-') k=1;//Èç¹ûÊÇ¸ºÊý£¬·ûºÅ²»ÓÃµ÷Õû£¬´Ó·ûºÅºóÃæ¿ªÊ¼µ÷Õû
 487          //      else k=0;//²»ÊÇ¸ºÊý£¬È«²¿¶¼Òªµ÷Õû
C51 COMPILER V9.60.0.0   MAIN                                                              10/19/2019 11:08:19 PAGE 9   

 488          // 
 489          //      
 490          //      for(j=k;j<=(i-1)/2;j++)//Í·Î²Ò»Ò»¶Ô³Æ½»»»£¬iÆäÊµ¾ÍÊÇ×Ö·û´®µÄ³¤¶È£¬Ë÷Òý×î´óÖµ±È³¤¶ÈÉÙ1
 491          //      {
 492          //              temp=str[j];//Í·²¿¸³Öµ¸øÁÙÊ±±äÁ¿
 493          //              str[j]=str[i-1+k-j];//Î²²¿¸³Öµ¸øÍ·²¿
 494          //              str[i-1+k-j]=temp;//½«ÁÙÊ±±äÁ¿µÄÖµ(ÆäÊµ¾ÍÊÇÖ®Ç°µÄÍ·²¿Öµ)¸³¸øÎ²²¿
 495          //      }
 496          // 
 497          //      return str;//·µ»Ø×ª»»ºóµÄ×Ö·û´®
 498          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1031    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     60      12
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
